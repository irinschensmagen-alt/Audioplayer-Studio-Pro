<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Studio EDU</title>
<style>
:root{
 --bg1:#eef2ff; --bg2:#e0f2fe; --bg3:#ede9fe;
 --card:#ffffffee; --text:#1f2937; --radius:18px;
}
body{
 margin:0; font-family:Inter,system-ui,sans-serif;
 background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
 min-height:100vh; display:flex; justify-content:center; padding:24px; color:var(--text);
}
.wrapper{
 display:grid; grid-template-columns:320px 420px; gap:22px;
}
.panel,.player{
 background:var(--card); backdrop-filter:blur(14px);
 border-radius:var(--radius); padding:16px;
 box-shadow:0 12px 32px rgba(0,0,0,.1);
}
h2{margin:0 0 12px; font-size:19px;}
label{font-size:12px; opacity:.75;}
input,select,button,textarea{width:100%; margin:6px 0 12px; font-family:inherit;}
button{border:none; border-radius:14px; padding:9px; cursor:pointer; background:linear-gradient(135deg,#c7d2fe,#bae6fd);}
.player{display:grid; gap:12px;}
.cover{height:150px; border-radius:14px; background:#e5e7eb center/cover;}
.controls{display:grid; grid-template-columns:auto auto auto; gap:10px; justify-content:center;}
.controls button{width:56px;}
.time{text-align:center; font-size:12px;}
.timeline{width:100%;}
canvas{width:100%; height:70px; border-radius:10px; background:#f8fafc;}
.playlist{display:none; font-size:13px; border-top:1px dashed #e5e7eb; padding-top:8px;}
.playlist div{padding:5px; border-radius:8px; cursor:pointer;}
.playlist div:hover{background:#eef2ff;}
</style>
</head>
<body>

<div class="wrapper">
<div class="panel">
<h2>ğŸ› Audio Studio EDU</h2>
<label>ğŸŒ Language</label><select id="lang"></select>
<label>ğŸ“ Mode</label>
<select id="mode"><option value="teacher">Teacher</option><option value="student">Student</option><option value="exam">Exam</option></select>
<label>ğŸµ Upload audio</label><input type="file" id="audioUpload" accept="audio/*" multiple>
<label>ğŸ–¼ Cover</label><input type="file" id="coverUpload" accept="image/*">
<button id="recordBtn">ğŸ™ Record</button>
<button onclick="generateIframe()">ğŸ“¦ iframe</button>
<textarea id="iframe"></textarea>
</div>

<div class="player">
<div class="cover" id="cover"></div>
<div class="controls">
<button id="back">âª</button>
<button id="play">â–¶</button>
<button id="fwd">â©</button>
</div>
<div class="time" id="time">00:00 / 00:00</div>
<input type="range" id="timeline" class="timeline" min="0" value="0" step="0.01">
<canvas id="viz"></canvas>
<button onclick="togglePlaylist()">ğŸ“‚ Playlist</button>
<div class="playlist" id="playlist"></div>
<audio id="audio" preload="metadata"></audio>
</div>

</div>

<script>
/* ---------- persistence ---------- */
const save=(k,v)=>localStorage.setItem(k,v);
const load=k=>localStorage.getItem(k);

/* ---------- audio core ---------- */
const audio=document.getElementById('audio');
const playBtn=document.getElementById('play');
const backBtn=document.getElementById('back');
const fwdBtn=document.getElementById('fwd');
const timeline=document.getElementById('timeline');
const timeEl=document.getElementById('time');
const playlistEl=document.getElementById('playlist');
let ctx,source,analyser,mediaRecorder,recordedChunks=[];

function initAudio(){
 if(ctx) return;
 ctx=new (window.AudioContext||window.webkitAudioContext)();
 source=ctx.createMediaElementSource(audio);
 analyser=ctx.createAnalyser(); analyser.fftSize=256;
 source.connect(analyser); analyser.connect(ctx.destination);
 visualize();
}

playBtn.onclick=()=>{initAudio(); audio.paused?audio.play():audio.pause();};
backBtn.onclick=()=>audio.currentTime=Math.max(0,audio.currentTime-5);
fwdBtn.onclick=()=>audio.currentTime=Math.min(audio.duration||0,audio.currentTime+5);

/* ---------- timeline ---------- */
timeline.oninput=()=>audio.currentTime=timeline.value;
audio.ontimeupdate=()=>{
 timeline.max=audio.duration||0;
 timeline.value=audio.currentTime;
 timeEl.textContent=`${fmt(audio.currentTime)} / ${fmt(audio.duration)}`;
};
const fmt=t=>isNaN(t)?'00:00':`${Math.floor(t/60)}:${String(Math.floor(t%60)).padStart(2,'0')}`;

/* ---------- uploads ---------- */
audioUpload.onchange=e=>{
 [...e.target.files].forEach(f=>{
  const url=URL.createObjectURL(f);
  const d=document.createElement('div');
  d.textContent=f.name;
  d.onclick=()=>{audio.src=url; audio.play()};
  playlistEl.appendChild(d);
 });
};
coverUpload.onchange=e=>cover.style.backgroundImage=`url(${URL.createObjectURL(e.target.files[0])})`;
function togglePlaylist(){playlistEl.style.display=playlistEl.style.display==='block'?'none':'block'}

/* ---------- visualizer ---------- */
const canvas=document.getElementById('viz'); const c=canvas.getContext('2d');
function visualize(){requestAnimationFrame(visualize); if(!analyser)return; const d=new Uint8Array(analyser.frequencyBinCount); analyser.getByteFrequencyData(d); c.clearRect(0,0,canvas.width,canvas.height); d.forEach((v,i)=>{c.fillStyle='#a5b4fc'; c.fillRect(i*3,canvas.height-v/2,2,v/2)})}

/* ---------- recording ---------- */
const recordBtn=document.getElementById('recordBtn');
recordBtn.onclick=async()=>{
 if(!mediaRecorder || mediaRecorder.state==='inactive'){
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder=new MediaRecorder(stream);
  recordedChunks=[];
  mediaRecorder.ondataavailable=e=>{if(e.data.size>0)recordedChunks.push(e.data)};
  mediaRecorder.onstop=()=>{
   const blob=new Blob(recordedChunks,{type:'audio/webm'});
   const url=URL.createObjectURL(blob);
   const d=document.createElement('div');
   d.textContent='Your Recording';
   d.onclick=()=>{audio.src=url; audio.play()};
   playlistEl.appendChild(d);
  };
  mediaRecorder.start();
  recordBtn.textContent='â¹ Stop Recording';
 } else {
  mediaRecorder.stop();
  recordBtn.textContent='ğŸ™ Record';
 }
};

/* ---------- modes ---------- */
mode.value=load('mode')||'teacher';
mode.onchange=e=>{
 save('mode',e.target.value);
 const ex=e.target.value==='exam';
 backBtn.style.display=fwdBtn.style.display=ex?'none':'inline-block';
 timeline.disabled=ex;
 recordBtn.disabled=ex;
};
mode.dispatchEvent(new Event('change'));

/* ---------- languages ---------- */
const langs={ru:'Ğ ÑƒÑÑĞºĞ¸Ğ¹',en:'English',de:'Deutsch',fr:'FranÃ§ais',es:'EspaÃ±ol',it:'Italiano',zh:'ä¸­æ–‡',ar:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',hi:'à¤¹à¤¿à¤¨à¥à¤¦à¥€'};
Object.entries(langs).forEach(([k,v])=>{const o=document.createElement('option'); o.value=k; o.textContent=v; lang.appendChild(o);});
lang.value=load('lang')||navigator.language.slice(0,2)||'en';
lang.onchange=e=>save('lang',e.target.value);

function generateIframe(){iframe.value=`<iframe src=\"${location.href}\" width=\"420\" height=\"580\" frameborder=\"0\"></iframe>`}
</script>
</body>
</html>
